# Provenance Methods Catalog (PROV / MCP)

**Status:** Normative (v0.1+)
This document defines the stable method identifiers used in:
- `prov.record.v0.1.methods[]`
- optional `evidence.v0.1.method`

Method IDs are:
- **append-only**
- **stable once published**
- **not user-facing UI**

If you need to change the meaning of an existing method ID, that is a **breaking change**.

---

## 1. Conventions

### 1.1 Namespacing
Use dotted, lowercase identifiers:

- `adapter.*` — envelope wrapping, transport, execution wrappers
- `engine.*` — evidence extraction, normalization, provenance construction
- `integrity.*` — hashing, signatures, verification
- `lineage.*` — parent linking and graph operations

### 1.2 Emission rules
- Emit only methods actually applied in the run.
- Prefer coarse-grained IDs to avoid noisy logs.
- IDs may be omitted if provenance capture is disabled.

### 1.3 Stability rules
- Add new IDs freely (non-breaking).
- Never rename IDs.
- Never change semantics without a major bump.

---

## 2. Adapter methods

### `adapter.wrap.envelope_v0_1`
**Meaning:** Wrapped a legacy tool payload into `mcp.envelope.v0.1`.
**When to emit:** Adapter created an envelope around non-envelope output.

### `adapter.pass_through.envelope_v0_1`
**Meaning:** Tool returned an envelope already; adapter returned it unchanged.
**When to emit:** Adapter performed pass-through without wrapping.

### `adapter.provenance.attach_record_v0_1`
**Meaning:** Adapter attached a `prov.record.v0.1` record to the envelope.
**When to emit:** Envelope contains a provenance record generated by adapter logic.

### `adapter.errors.capture`
**Meaning:** Adapter captured an execution failure and emitted `errors[]` in the envelope.
**When to emit:** Tool failed and adapter populated standardized envelope errors.

### `adapter.warnings.capture`
**Meaning:** Adapter captured non-fatal warnings and emitted `warnings[]` in the envelope.
**When to emit:** Partial results, degraded mode, etc.

---

## 3. Engine methods (provenance construction)

### `engine.prov.record_v0_1.build`
**Meaning:** Constructed a `prov.record.v0.1` record.
**When to emit:** Provenance record created by engine/adapter.

### `engine.prov.artifact.register_input`
**Meaning:** Registered one or more input artifacts in provenance.
**When to emit:** Inputs list populated (regardless of digest presence).

### `engine.prov.artifact.register_output`
**Meaning:** Registered one or more output artifacts in provenance.
**When to emit:** Outputs list populated.

### `engine.extract.evidence.json_pointer`
**Meaning:** Evidence anchors were derived using JSON pointer-style fragments (e.g., `#json:/fix/1`).
**When to emit:** Evidence anchors include `#json:/...`.

### `engine.extract.evidence.text_lines`
**Meaning:** Evidence anchors were derived using text line ranges (e.g., `#text:line:12-14`).
**When to emit:** Evidence anchors include `#text:line:...`.

### `engine.coerce.evidence.v0_1`
**Meaning:** Converted or normalized tool-provided evidence into `evidence.v0.1`.
**When to emit:** Tool evidence was adapted into the canonical evidence schema.

---

## 4. Integrity methods

### `integrity.digest.sha256`
**Meaning:** Computed sha256 digest(s) for one or more artifacts.
**When to emit:** Any artifact digest uses sha256 and was computed during this run.

### `integrity.digest.sha512`
**Meaning:** Computed sha512 digest(s) for one or more artifacts.
**When to emit:** Any artifact digest uses sha512 and was computed during this run.

### `integrity.digest.blake3`
**Meaning:** Computed blake3 digest(s) for one or more artifacts.
**When to emit:** Any artifact digest uses blake3 and was computed during this run.

### `integrity.record_digest.compute`
**Meaning:** Computed `integrity.record_digest` for the provenance record.
**When to emit:** `prov.record.integrity.record_digest` is populated.

### `integrity.signature.create`
**Meaning:** Created a signature over the provenance record digest.
**When to emit:** `prov.record.integrity.signature` is populated (signing performed).

### `integrity.signature.verify`
**Meaning:** Verified a provenance record signature successfully.
**When to emit:** `provenance.verify` tool confirms signature validity.

---

## 5. Lineage methods

### `lineage.parent.link`
**Meaning:** Linked this provenance record to one or more parent runs via `parents[]`.
**When to emit:** `parents[]` populated to indicate dependency.

### `lineage.graph.build`
**Meaning:** Built a lineage graph from one or more provenance records.
**When to emit:** A graph/DAG representation was constructed.

---

## 6. Guidance for adding new method IDs

Add a new ID when:
- a new envelope/provenance capability is introduced, or
- a new evidence anchor format becomes supported, or
- a new integrity mechanism is added.

Do not add IDs for trivial internal refactors.

All new IDs must be:
- documented here
- covered by at least one test or example
